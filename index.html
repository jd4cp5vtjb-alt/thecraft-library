<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="TheCraft Library">
<meta name="msapplication-TileColor" content="#1E3A8A">
<meta name="theme-color" content="#1E3A8A">
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="icon.png">
<link rel="icon" type="image/png" sizes="16x16" href="icon.png">
<title>TheCraft Library V4.1</title>
<link rel="manifest" href="manifest.json">
<style>
/* ========================================
   üé® SYST√àME DE TH√àMES V4.1
   Variables CSS ‚Üí Switch auto iOS
   ======================================== */

/* ‚òÄÔ∏è TH√àME CLAIR (par d√©faut) */
:root {
  --bg: #FFFFFF;
  --text: #000000;
  --text-secondary: #64748B;
  --card: #FFFFFF;
  --border: #E2E8F0;
  --shadow: rgba(0,0,0,0.08);
  --accent: #3B82F6;
  --accent-hover: #2563EB;
  --overlay: rgba(0,0,0,0.7);
  --overlay-text: #FFFFFF;
  --fab-bg: rgba(255,255,255,0.6);
  --fab-border: rgba(0,0,0,0.1);
  --tag-bg: rgba(59,130,246,0.1);
  --tag-text: #3B82F6;
  --modal-bg: #FFFFFF;
  --modal-text: #000000;
  --chip-bg: rgba(59,130,246,0.08);
  --chip-border: rgba(59,130,246,0.2);
  --chip-text: #3B82F6;
  --input-bg: #F8FAFC;
  --input-border: #E2E8F0;
  --menu-hover: rgba(0,0,0,0.05);
  --search-bg: rgba(255,255,255,0.95);
  --search-input-bg: rgba(0,0,0,0.05);
  --search-input-border: rgba(0,0,0,0.1);
  --search-text: #000000;
  --search-placeholder: rgba(0,0,0,0.4);
  --search-btn-bg: rgba(0,0,0,0.08);
  --material-card-bg: #FFFFFF;
  --material-card-border: rgba(0,0,0,0.1);
  --material-card-shadow: rgba(0,0,0,0.1);
}

/* üåô TH√àME SOMBRE (auto quand iOS en mode sombre) */
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #1E3A8A;
    --text: #FFFFFF;
    --text-secondary: #94A3B8;
    --card: #1E3A8A;
    --border: rgba(255,255,255,0.2);
    --shadow: rgba(0,0,0,0.5);
    --accent: #3B82F6;
    --accent-hover: #60A5FA;
    --overlay: rgba(0,0,0,0.8);
    --overlay-text: #FFFFFF;
    --fab-bg: rgba(30,58,138,0.6);
    --fab-border: rgba(255,255,255,0.2);
    --tag-bg: rgba(59,130,246,0.2);
    --tag-text: #60A5FA;
    --modal-bg: #1E3A8A;
    --modal-text: #FFFFFF;
    --chip-bg: rgba(59,130,246,0.15);
    --chip-border: rgba(59,130,246,0.3);
    --chip-text: #60A5FA;
    --input-bg: rgba(255,255,255,0.05);
    --input-border: rgba(255,255,255,0.2);
    --menu-hover: rgba(255,255,255,0.1);
    --search-bg: rgba(30,58,138,0.95);
    --search-input-bg: rgba(255,255,255,0.15);
    --search-input-border: rgba(255,255,255,0.25);
    --search-text: #FFFFFF;
    --search-placeholder: rgba(255,255,255,0.5);
    --search-btn-bg: rgba(255,255,255,0.15);
    --material-card-bg: #1E3A8A;
    --material-card-border: rgba(255,255,255,0.2);
    --material-card-shadow: rgba(0,0,0,0.5);
  }
}

/* ========================================
   RESET & BASE
   ======================================== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html {
  background: var(--bg);
}
body {
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  padding-bottom: 100px;
}

/* ========================================
   MENU BURGER
   ======================================== */
.menu-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  width: 44px;
  height: 44px;
  background: var(--fab-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-radius: 50%;
  border: 1px solid var(--fab-border);
  cursor: pointer;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 5px;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px var(--shadow);
}
.menu-btn span {
  width: 18px;
  height: 2px;
  background: var(--text-secondary);
  border-radius: 2px;
}

.menu-dropdown {
  position: fixed;
  top: 75px;
  right: 20px;
  background: var(--card);
  border-radius: 16px;
  padding: 8px;
  z-index: 999;
  display: none;
  min-width: 180px;
  border: 1px solid var(--border);
  box-shadow: 0 8px 24px var(--shadow);
}
.menu-dropdown.active { display: block; }

.menu-item {
  padding: 14px 18px;
  border-radius: 12px;
  cursor: pointer;
  color: var(--text);
  font-weight: 500;
  transition: background 0.2s;
}
.menu-item:active {
  background: var(--menu-hover);
}

/* ========================================
   PAGE HEADER & TITLES
   ======================================== */
.page-header { padding: 24px 20px 8px; }
.page-subtitle { font-size: 0.8em; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 1.2px; margin-bottom: 6px; }
.page-title { font-size: 2.2em; font-weight: 900; letter-spacing: -0.8px; }
.section-title { font-size: 1.5em; font-weight: 800; padding: 0 20px; margin: 32px 0 16px; }

/* ========================================
   SCROLL HORIZONTAL
   ======================================== */
.scroll-h { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-bottom: 32px; }
.scroll-h::-webkit-scrollbar { display: none; }
.scroll-h .cards { display: flex; gap: 16px; padding: 0 20px; }

.h-scroll-container {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
  padding: 0 20px 20px 20px;
  margin-bottom: 32px;
}
.h-scroll-container::-webkit-scrollbar { display: none; }
.h-scroll {
  display: flex;
  gap: 16px;
  padding-bottom: 4px;
}
.h-scroll .card {
  flex: 0 0 280px;
  min-width: 280px;
}

/* ========================================
   H-CARD (Nouveaut√©s horizontales)
   ======================================== */
.h-card {
  min-width: 280px;
  height: 340px;
  border-radius: 24px;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 4px 20px var(--shadow);
  position: relative;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  overflow: hidden;
  flex-shrink: 0;
}
.h-card:active { transform: scale(0.97); }
.h-card:hover { transform: translateY(-6px); }
.h-card img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; display: block; }
.h-card .overlay {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  padding: 24px 20px;
  background: linear-gradient(to top, var(--overlay), transparent);
  z-index: 1;
  color: var(--overlay-text);
}
.h-card h3 { font-size: 1.3em; font-weight: 800; }
.h-card .tag {
  font-size: 0.7em;
  background: var(--tag-bg);
  color: var(--tag-text);
  padding: 6px 12px;
  border-radius: 8px;
  display: inline-block;
  margin-bottom: 8px;
  font-weight: 600;
}

/* ========================================
   GRID & CARD (Favoris, D√©couvertes)
   ======================================== */
.grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; padding: 0 20px; margin-bottom: 32px; }

.card {
  min-height: 340px;
  height: 340px;
  border-radius: 24px;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 4px 20px var(--shadow);
  position: relative;
  cursor: pointer;
  transition: transform 0.3s, box-shadow 0.3s;
  overflow: hidden;
}
.card:active { transform: scale(0.97); }
.card:hover { transform: translateY(-6px); }
.card img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; display: block; }
.card .overlay {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  padding: 28px 20px;
  background: linear-gradient(to top, var(--overlay), transparent);
  z-index: 1;
  color: var(--overlay-text);
}
.card h3 { font-size: 1.5em; font-weight: 800; }
.card .tag {
  font-size: 0.75em;
  background: var(--tag-bg);
  color: var(--tag-text);
  padding: 6px 12px;
  border-radius: 10px;
  display: inline-block;
  margin-bottom: 10px;
  font-weight: 600;
}

/* ========================================
   FAVORIS BUTTON
   ======================================== */
.fav-btn {
  position: absolute; top: 16px; right: 16px;
  font-size: 1.6em; cursor: pointer; z-index: 10;
  filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
  user-select: none;
}
.fav-btn:hover { transform: scale(1.15); }

/* ========================================
   CATEGORY CHIPS
   ======================================== */
.cats { overflow-x: auto; padding: 16px 0; margin-bottom: 24px; }
.cats::-webkit-scrollbar { display: none; }
.cats .list { display: flex; gap: 10px; padding: 0 20px; }

.cat-chip {
  padding: 10px 18px;
  border-radius: 20px;
  background: var(--card);
  border: 1px solid var(--border);
  font-size: 0.9em;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  color: var(--text);
  transition: all 0.2s;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}
.cat-chip:active {
  background: var(--menu-hover);
}
.cat-chip.active {
  background: var(--accent);
  border-color: var(--accent);
  color: #FFFFFF;
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.25);
}

/* ========================================
   MATERIAL GRID (V4.0 grille)
   ======================================== */
.material-grid {
  display: flex;
  flex-wrap: wrap;
  padding: 0 10px;
}
.material-card {
  width: 49%;
  margin: 0.5%;
  height: 200px;
  border-radius: 20px;
  overflow: hidden;
  position: relative;
  cursor: pointer;
  background: var(--material-card-bg);
  border: 1px solid var(--material-card-border);
  box-shadow: 0 2px 12px var(--material-card-shadow);
  transition: transform 0.2s;
}
@media (min-width: 600px) {
  .material-card { width: 32.66%; margin: 0.5%; height: 250px; }
}
@media (min-width: 900px) {
  .material-card { width: 24%; margin: 0.5%; height: 280px; }
}
.material-card:active { transform: scale(0.97); }
.material-card img { width: 100%; height: 100%; object-fit: cover; }
.material-card .overlay {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
  padding: 16px 12px 12px;
  color: #fff;
  z-index: 1;
}
.material-card h3 { font-size: 1em; font-weight: 700; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
.material-card .fav-btn {
  position: absolute; top: 12px; right: 12px;
  font-size: 1.5em; cursor: pointer; z-index: 2;
  filter: drop-shadow(0 2px 8px rgba(0,0,0,0.4));
  user-select: none; transition: transform 0.2s;
}
.material-card .fav-btn:active { transform: scale(0.9); }

/* ========================================
   PINTEREST (Recherche)
   ======================================== */
.pinterest { padding: 0 16px; column-count: 2; column-gap: 16px; }
@media (min-width: 600px) { .pinterest { column-count: 3; } }

.pint-item {
  break-inside: avoid;
  margin-bottom: 16px;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 2px 12px var(--shadow);
  border-radius: 20px;
  overflow: hidden;
  cursor: pointer;
  display: inline-block;
  width: 100%;
  position: relative;
  transition: transform 0.3s;
}
.pint-item:hover { transform: translateY(-6px); }
.pint-item img { width: 100%; display: block; object-fit: cover; min-height: 180px; max-height: 280px; }
.pint-item.tall img { height: 280px; }
.pint-item.short img { height: 180px; }
.pint-item .info { padding: 14px; background: var(--card); }
.pint-item h3 { font-size: 1em; font-weight: 700; margin-bottom: 8px; }
.pint-item .tag {
  background: var(--tag-bg);
  color: var(--tag-text);
  padding: 6px 12px;
  border-radius: 8px;
  font-size: 0.7em;
  font-weight: 600;
  display: inline-block;
  margin-bottom: 6px;
}
.pint-item .price {
  font-size: 0.9em; font-weight: 700; margin-top: 6px;
  background: var(--tag-bg);
  padding: 6px 12px; border-radius: 8px; display: inline-block;
}

/* ========================================
   DISCOVER CARDS
   ======================================== */
.discover { margin-bottom: 32px; }
.discover h2 { font-size: 1.5em; font-weight: 800; padding: 0 20px; margin-bottom: 16px; }
.discover .scroll { overflow-x: auto; }
.discover .scroll::-webkit-scrollbar { display: none; }
.discover .list { display: flex; gap: 16px; padding: 0 20px; }

.disc-card {
  min-width: 240px; width: 240px; height: 280px;
  border-radius: 20px;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 4px 16px var(--shadow);
  position: relative;
  cursor: pointer;
  overflow: hidden;
  transition: transform 0.3s, box-shadow 0.3s;
  flex-shrink: 0;
}
.disc-card:active { transform: scale(0.97); }
.disc-card:hover { transform: translateY(-4px); }
.disc-card img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; display: block; }
.disc-card .name {
  position: absolute; bottom: 0; left: 0; right: 0;
  padding: 20px 16px;
  background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
  color: #fff;
}
.disc-card h4 { font-size: 1.1em; font-weight: 700; }

/* ========================================
   TAB BAR
   ======================================== */
.tab-bar {
  position: fixed;
  bottom: 20px; left: 20px; right: 20px;
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: 0 8px 24px var(--shadow);
  border-radius: 50px;
  display: flex;
  justify-content: space-around;
  padding: 8px 6px;
  z-index: 100;
}
.tab-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 10px 12px;
  border-radius: 20px;
  cursor: pointer;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  min-width: 60px;
  font-size: 0.75em;
  font-weight: 500;
  transition: all 0.3s;
}
.tab-item.active {
  color: var(--accent);
  font-weight: 600;
}
.tab-item svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2.5; }
.tab-item span { font-size: 0.9em; margin-top: 4px; font-weight: 600; }

/* ========================================
   FAB + FAB MENU
   ======================================== */
.fab {
  position: fixed;
  bottom: 100px; right: 24px;
  width: 44px; height: 44px;
  border-radius: 50%;
  background: var(--fab-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--fab-border);
  color: var(--text-secondary);
  font-size: 24px;
  cursor: pointer;
  z-index: 99;
  box-shadow: 0 4px 12px var(--shadow);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.2s;
}
.fab:active { transform: scale(0.92); }

.fab-menu-dropdown {
  position: fixed;
  bottom: 160px; right: 20px;
  background: var(--card);
  border-radius: 16px;
  padding: 8px;
  z-index: 999;
  display: none;
  min-width: 200px;
  border: 1px solid var(--border);
  box-shadow: 0 8px 24px var(--shadow);
}
.fab-menu-dropdown.active { display: block; }

.fab-menu-item {
  padding: 14px 18px;
  border-radius: 12px;
  cursor: pointer;
  color: var(--text);
  font-weight: 500;
  transition: background 0.2s;
  display: flex;
  align-items: center;
  gap: 12px;
}
.fab-menu-item:active {
  background: var(--menu-hover);
}
.fab-menu-icon { font-size: 1.5em; }
.fab-menu-text { font-size: 0.95em; font-weight: 600; color: var(--text); }

/* ========================================
   TAB CONTENT
   ======================================== */
.tab-content { display: none; }
.tab-content.active { display: block; }

.empty { text-align: center; padding: 80px 20px; opacity: 0.7; }
.empty h3 { font-size: 1.3em; margin-bottom: 10px; }

/* ========================================
   SEARCH MODAL
   ======================================== */
.search-modal {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: var(--search-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  z-index: 2000;
  padding: 20px;
  padding-top: 70px;
  overflow-y: auto;
}
.search-modal.active { display: block; }

body.modal-open {
  overflow: hidden;
  position: fixed;
  width: 100%;
}

.search-header { display: flex; gap: 12px; margin-bottom: 20px; }
.search-header input {
  flex: 1; padding: 14px 18px; border-radius: 16px;
  border: 1px solid var(--search-input-border);
  background: var(--search-input-bg);
  color: var(--search-text);
  font-size: 1em;
}
.search-header input::placeholder { color: var(--search-placeholder); }
.search-header button {
  background: var(--search-btn-bg);
  border: 1px solid var(--search-input-border);
  padding: 12px 20px;
  border-radius: 14px;
  color: var(--search-text);
  font-weight: 600;
  cursor: pointer;
}

/* ========================================
   FAVORITES MODAL
   ======================================== */
.favorites-modal {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  z-index: 3000;
  padding: 0;
}
.favorites-modal.active {
  display: flex;
  align-items: center;
  justify-content: center;
}
.favorites-close {
  position: fixed; top: 20px; right: 20px;
  width: 44px; height: 44px;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(20px);
  border-radius: 50%; border: none;
  font-size: 1.3em; color: #fff;
  cursor: pointer; z-index: 3001;
  display: flex; align-items: center; justify-content: center;
}
.favorites-scroll {
  width: 100%; max-width: 100vw; height: 100%;
  overflow-x: auto; overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scroll-snap-type: x mandatory;
  display: flex; align-items: center;
  padding: 40px 0;
}
.favorites-scroll::-webkit-scrollbar { display: none; }
.favorites-list { display: flex; height: 100%; align-items: center; padding: 0 20px; }
.favorite-slide {
  min-width: calc(100vw - 80px); width: calc(100vw - 80px);
  height: 85vh; margin: 0 20px;
  display: flex; flex-direction: column;
  scroll-snap-align: center;
  position: relative; border-radius: 24px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
  flex-shrink: 0;
}
.favorite-slide img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
.favorite-slide .info-overlay {
  position: absolute; bottom: 0; left: 0; right: 0;
  padding: 32px 24px;
  background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 40%, transparent 70%);
}
.favorite-slide .badge {
  display: inline-block;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(10px);
  padding: 6px 14px; border-radius: 12px;
  font-size: 0.75em; text-transform: uppercase;
  letter-spacing: 1px; font-weight: 700;
  margin-bottom: 12px; color: #fff;
}
.favorite-slide h2 { font-size: 2em; font-weight: 900; margin-bottom: 8px; color: #fff; }
.favorite-slide .supplier { font-size: 1.1em; opacity: 0.9; font-weight: 600; margin-bottom: 12px; color: #fff; }
.favorite-slide .description { font-size: 0.95em; opacity: 0.85; line-height: 1.5; color: #fff; }
.favorites-empty { display: flex; align-items: center; justify-content: center; height: 100%; width: 100%; flex-direction: column; padding: 40px; text-align: center; }
.favorites-empty h2 { font-size: 2em; font-weight: 900; margin-bottom: 16px; color: #fff; }
.favorites-empty p { font-size: 1.1em; opacity: 0.8; color: #fff; }

/* ========================================
   DETAIL MODAL
   ======================================== */
.detail-modal {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(10px);
  z-index: 4000;
  overflow-y: auto;
}
.detail-modal.active { display: block; }
.detail-content {
  background: var(--modal-bg);
  margin: 60px 20px;
  border-radius: 28px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.4);
}
.detail-header {
  position: sticky; top: 0;
  background: var(--modal-bg);
  backdrop-filter: blur(30px);
  padding: 16px 20px;
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid var(--border);
  z-index: 100;
}
.detail-header h2 { font-size: 1.1em; font-weight: 700; color: var(--modal-text); }
.detail-header button {
  background: var(--menu-hover);
  border: 1px solid var(--border);
  border-radius: 12px;
  width: 38px; height: 38px;
  font-size: 1.3em;
  color: var(--modal-text);
  cursor: pointer;
}
.detail-content img { width: 100%; max-height: 400px; object-fit: cover; }
.detail-info { padding: 28px; }
.detail-info h1 { font-size: 2em; font-weight: 800; margin-bottom: 14px; color: var(--modal-text); }
.detail-meta { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
.detail-meta .meta-tag {
  background: var(--tag-bg);
  padding: 8px 16px; border-radius: 12px;
  font-size: 0.9em; color: var(--tag-text);
  font-weight: 600; border: 1px solid var(--tag-bg);
}
.detail-info p { margin-bottom: 16px; color: var(--modal-text); font-size: 1em; line-height: 1.7; opacity: 0.8; }
.detail-info strong { font-weight: 700; opacity: 1; }
.detail-info a { color: var(--accent); }
.detail-actions { display: flex; gap: 12px; padding: 0 28px 32px; }
.detail-actions button { flex: 1; padding: 16px; border-radius: 16px; border: none; font-size: 1.05em; font-weight: 700; cursor: pointer; }
.detail-actions .edit-btn { background: var(--accent); color: #fff; }

/* ========================================
   ADD/EDIT FORM MODAL
   ======================================== */
.modal-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.6);
  backdrop-filter: blur(10px);
  z-index: 3000;
  overflow-y: auto;
  align-items: center;
  justify-content: center;
}
.modal-overlay.active { display: flex; }

.add-form {
  background: var(--modal-bg);
  width: calc(100% - 40px);
  max-width: 500px;
  border-radius: 28px;
  padding: 28px;
  max-height: 90vh;
  overflow-y: auto;
}
.form-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
.form-header h2 { font-size: 1.4em; font-weight: 800; color: var(--modal-text); }
.form-header button {
  background: var(--menu-hover);
  border: none;
  width: 36px; height: 36px;
  border-radius: 50%;
  font-size: 1.1em;
  cursor: pointer;
  color: var(--modal-text);
}
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-size: 0.85em; font-weight: 600; color: var(--modal-text); opacity: 0.7; margin-bottom: 8px; }
.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 14px 16px;
  border-radius: 14px;
  border: 1px solid var(--input-border);
  font-size: 1em;
  background: var(--input-bg);
  color: var(--modal-text);
}
.form-group textarea { resize: vertical; min-height: 80px; }

/* Supplier & Category chips in form */
.supplier-selector,
.category-selector {
  margin-top: 8px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.supplier-selector::-webkit-scrollbar,
.category-selector::-webkit-scrollbar { display: none; }

.supplier-chips,
.category-chips {
  display: flex;
  gap: 8px;
  padding-bottom: 4px;
}
.supplier-chip,
.category-chip {
  flex: 0 0 auto;
  padding: 10px 18px;
  border-radius: 20px;
  background: var(--chip-bg);
  border: 2px solid var(--chip-border);
  color: var(--text);
  font-size: 0.9em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
  user-select: none;
}
.supplier-chip:active,
.category-chip:active { transform: scale(0.95); }
.supplier-chip.selected,
.category-chip.selected {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
}

/* Category type selector */
.category-type-selector { display: flex; gap: 12px; margin-top: 8px; }
.cat-type-btn {
  flex: 1;
  padding: 14px;
  border-radius: 12px;
  background: var(--menu-hover);
  border: 2px solid var(--border);
  color: var(--modal-text);
  font-size: 0.95em;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
.cat-type-btn:active { transform: scale(0.97); }
.cat-type-btn.active {
  background: var(--accent);
  border-color: var(--accent);
  color: #fff;
}

.type-selector { display: flex; gap: 12px; margin-bottom: 24px; }
.type-btn {
  flex: 1; padding: 14px;
  border: 2px solid var(--chip-border);
  background: var(--chip-bg);
  border-radius: 14px;
  font-size: 0.95em;
  font-weight: 600;
  cursor: pointer;
  color: var(--modal-text);
}
.type-btn.active { border-color: var(--accent); background: var(--tag-bg); color: var(--accent); }

.submit-btn {
  width: 100%; padding: 18px;
  background: var(--accent); color: #fff;
  border: none; border-radius: 16px;
  font-size: 1.05em; font-weight: 700;
  cursor: pointer; margin-top: 12px;
}
.delete-btn {
  width: 100%; padding: 18px;
  background: linear-gradient(135deg, #dc2626, #991b1b);
  color: #fff; border: none; border-radius: 16px;
  font-size: 1.05em; font-weight: 700;
  cursor: pointer; margin-top: 10px;
}
.image-upload {
  border: 2px dashed var(--border);
  border-radius: 14px;
  padding: 32px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s;
  background: var(--menu-hover);
}
.image-upload:hover { border-color: var(--accent); }
.image-upload svg { color: var(--text-secondary); margin-bottom: 12px; }
.image-upload p { color: var(--text-secondary); font-size: 0.95em; }
.image-upload.has-image { border-style: solid; padding: 0; }
.image-upload.has-image img { width: 100%; height: 200px; object-fit: cover; border-radius: 12px; }
</style>
</head>
<body>

<button class="menu-btn" id="menuBtn">
  <span></span>
  <span></span>
  <span></span>
</button>
<div class="menu-dropdown" id="menu">
  <div class="menu-item" id="syncBtn">‚òÅÔ∏è Sync iCloud</div>
  <div class="menu-item" id="importBtn">üì• Importer</div>
  <div class="menu-item" id="favBtn">‚ù§Ô∏è Favoris</div>
</div>

<main>
  <div class="tab-content active" id="home">
    <div class="page-header">
      <div class="page-subtitle">Biblioth√®que de mat√©riaux</div>
      <h1 class="page-title">TheCraft Library</h1>
    </div>
    <h2 class="section-title">Les derni√®res nouveaut√©s</h2>
    <div class="scroll-h"><div class="cards" id="latest"></div></div>
    <h2 class="section-title">Les coups de c≈ìur</h2>
    <div class="h-scroll-container"><div class="h-scroll" id="favorites"></div></div>
    <h2 class="section-title">√Ä d√©couvrir aujourd'hui</h2>
    <div class="h-scroll-container"><div class="h-scroll" id="daily"></div></div>
  </div>

  <div class="tab-content" id="suppliers">
    <div class="page-header">
      <div class="page-subtitle">Annuaire professionnel</div>
      <h1 class="page-title">Fournisseurs</h1>
    </div>
    <div class="discover">
      <h2>Les fournisseurs √† d√©couvrir</h2>
      <div class="scroll"><div class="list" id="disc-suppliers"></div></div>
    </div>
    <h2 class="section-title">Tous les fournisseurs</h2>
    <div class="cats"><div class="list" id="cat-suppliers"></div></div>
    <div class="material-grid" id="pint-suppliers"></div>
  </div>

  <div class="tab-content" id="materials">
    <div class="page-header">
      <div class="page-subtitle">Collection compl√®te</div>
      <h1 class="page-title">Mat√©riaux</h1>
    </div>
    <div class="discover">
      <h2>Les mat√©riaux √† d√©couvrir</h2>
      <div class="scroll"><div class="list" id="disc-materials"></div></div>
    </div>
    <h2 class="section-title">Tous les mat√©riaux</h2>
    <div class="cats"><div class="list" id="cat-materials"></div></div>
    <div class="material-grid" id="pint-materials"></div>
  </div>
</main>

<button class="fab" id="fabBtn">+</button>

<div class="fab-menu-dropdown" id="fabMenuDropdown">
  <div class="fab-menu-item" data-add-type="material">
    <span class="fab-menu-icon">üì¶</span>
    <span class="fab-menu-text">Mat√©riau</span>
  </div>
  <div class="fab-menu-item" data-add-type="supplier">
    <span class="fab-menu-icon">üè¢</span>
    <span class="fab-menu-text">Fournisseur</span>
  </div>
  <div class="fab-menu-item" data-add-type="category">
    <span class="fab-menu-icon">üè∑Ô∏è</span>
    <span class="fab-menu-text">Cat√©gorie</span>
  </div>
</div>

<nav class="tab-bar">
  <button class="tab-item active" data-tab="home">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span>Accueil</span>
  </button>
  <button class="tab-item" data-tab="suppliers">
    <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
    <span>Fournisseurs</span>
  </button>
  <button class="tab-item" data-tab="materials">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
    <span>Mat√©riaux</span>
  </button>
  <button class="tab-item" id="searchBtn">
    <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <span>Recherche</span>
  </button>
</nav>

<div class="search-modal" id="searchModal">
  <div class="search-header">
    <input type="text" placeholder="Rechercher..." id="searchInput">
    <button id="closeSearch">Annuler</button>
  </div>
  <div class="search-results" id="searchResults"></div>
</div>

<div class="modal-overlay" id="addModal">
  <div class="add-form">
    <div class="form-header">
      <h2 id="formTitle">Ajouter</h2>
      <button id="closeAddForm">‚úï</button>
    </div>
    <form id="addForm">
      <div class="form-group">
        <label>Photo</label>
        <input type="file" id="imageUpload" accept="image/*" style="display:none;">
        <div class="image-upload" id="imageUploadArea">
          <svg viewBox="0 0 24 24" width="40" height="40" stroke="currentColor" fill="none" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
          </svg>
          <p>Ajouter une photo</p>
        </div>
      </div>
      <div class="form-group">
        <label for="itemName">Nom *</label>
        <input type="text" id="itemName" required>
      </div>
      <div class="form-group">
        <label>Cat√©gorie</label>
        <div class="category-selector">
          <div class="category-chips" id="categoryChips"></div>
        </div>
        <input type="hidden" id="itemCategory">
      </div>
      <div class="form-group material-only">
        <label>Fournisseur</label>
        <div class="supplier-selector">
          <div class="supplier-chips" id="supplierChips"></div>
        </div>
        <input type="hidden" id="itemSupplier">
      </div>
      <div class="form-group material-only">
        <label for="itemPrice">Prix</label>
        <input type="text" id="itemPrice" placeholder="ex: 150‚Ç¨/m¬≤">
      </div>
      <div class="form-group supplier-only" style="display:none;">
        <label for="itemPhone">T√©l√©phone</label>
        <input type="tel" id="itemPhone" placeholder="ex: +33 1 23 45 67 89">
      </div>
      <div class="form-group supplier-only" style="display:none;">
        <label for="itemEmail">Email</label>
        <input type="email" id="itemEmail" placeholder="ex: contact@fournisseur.fr">
      </div>
      <div class="form-group supplier-only" style="display:none;">
        <label for="itemWebsite">Site web</label>
        <input type="url" id="itemWebsite" placeholder="ex: https://www.fournisseur.fr">
      </div>
      <div class="form-group">
        <label for="itemDescription">Description</label>
        <textarea id="itemDescription" placeholder="Description..."></textarea>
      </div>
      <button type="submit" class="submit-btn" id="submitBtn">Cr√©er</button>
      <button type="button" class="delete-btn" id="deleteBtn" style="display:none;">Supprimer</button>
    </form>
  </div>
</div>

<div class="modal-overlay" id="categoryModal">
  <div class="add-form">
    <div class="form-header">
      <h2>Nouvelle cat√©gorie</h2>
      <button id="closeCategoryForm">‚úï</button>
    </div>
    <form id="categoryForm">
      <div class="form-group">
        <label for="categoryName">Nom *</label>
        <input type="text" id="categoryName" placeholder="ex: Bois, Pierre, N√©goce..." required>
      </div>
      <div class="form-group">
        <label>Type</label>
        <div class="category-type-selector">
          <button type="button" class="cat-type-btn active" data-cat-type="material">üì¶ Mat√©riaux</button>
          <button type="button" class="cat-type-btn" data-cat-type="supplier">üè¢ Fournisseurs</button>
        </div>
      </div>
      <button type="submit" class="submit-btn">Cr√©er</button>
    </form>
  </div>
</div>

<div class="favorites-modal" id="favoritesModal">
  <button class="favorites-close" id="closeFavorites">‚úï</button>
  <div class="favorites-scroll" id="favoritesScroll">
    <div class="favorites-list" id="favoritesList"></div>
  </div>
</div>

<div class="detail-modal" id="detailModal">
  <div class="detail-content">
    <div class="detail-header">
      <h2>D√©tails</h2>
      <button id="closeDetailBtn">‚úï</button>
    </div>
    <div id="detailBody"></div>
  </div>
</div>

<script>
let items = [
  {id:'1',type:'material',name:'Ch√™ne Massif',category:'Bois',price:'245‚Ç¨/m¬≤',contact:'Bois & Nature',description:'Bois de ch√™ne massif naturel',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23a0826d" width="400" height="300"/%3E%3C/svg%3E',favorite:true,createdAt:Date.now()-86400000*5,updatedAt:Date.now()-86400000*2},
  {id:'2',type:'supplier',name:'Bois & Nature',category:'Menuiserie',contact:'www.boisnature.fr',description:'Sp√©cialiste bois et parquets',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%238b4513" width="400" height="300"/%3E%3C/svg%3E',favorite:true,createdAt:Date.now()-86400000*3,updatedAt:Date.now()},
  {id:'3',type:'material',name:'Marbre Calacatta',category:'Pierre',price:'580‚Ç¨/m¬≤',contact:'Marbre Prestige',description:'Marbre italien avec veines dor√©es',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23f5f5f0" width="400" height="300"/%3E%3C/svg%3E',favorite:false,createdAt:Date.now()-86400000*7,updatedAt:Date.now()-86400000*7},
  {id:'4',type:'material',name:'Acier Inoxydable',category:'M√©tal',price:'180‚Ç¨/m¬≤',contact:'M√©tal Concept',description:'Acier inoxydable 304 bross√©',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23b8c5d6" width="400" height="300"/%3E%3C/svg%3E',favorite:false,createdAt:Date.now()-86400000*1,updatedAt:Date.now()-86400000*1}
];

let daily = [];
let activeCategorySuppliers = 'Tous';
let activeCategoryMaterials = 'Tous';
let selectedType = 'material';
let uploadedImageUrl = '';
let editingId = null;

function init() {
  loadFromStorage();
  loadDaily();
  render();
  setupEvents();
}

async function loadFromStorage() {
  const stored = localStorage.getItem('thecraft-items');
  if (stored) {
    try {
      items = JSON.parse(stored);
      console.log('‚úÖ Charg√© depuis localStorage:', items.length, 'items');
      return;
    } catch (e) {
      console.error('‚ùå Erreur parse localStorage:', e);
    }
  }
  try {
    const resMat = await fetch('https://raw.githubusercontent.com/jd4cp5vtjb-alt/thecraft-library/main/materials.json');
    if (resMat.ok) {
      const materials = await resMat.json();
      const resSup = await fetch('https://raw.githubusercontent.com/jd4cp5vtjb-alt/thecraft-library/main/suppliers.json');
      if (resSup.ok) {
        const suppliers = await resSup.json();
        items = [...materials, ...suppliers];
        localStorage.setItem('thecraft-items', JSON.stringify(items));
        console.log('‚úÖ Charg√© depuis GitHub (premi√®re fois):', items.length, 'items');
        return;
      }
    }
  } catch (e) {
    console.log('‚ö†Ô∏è GitHub non accessible');
  }
  console.log('‚ÑπÔ∏è Premi√®re installation - Aucune donn√©e');
}

function setupEvents() {
  document.getElementById('menuBtn').addEventListener('click', toggleMenu);
  document.getElementById('syncBtn').addEventListener('click', syncToiCloud);
  document.getElementById('importBtn').addEventListener('click', importData);
  document.getElementById('favBtn').addEventListener('click', openFavoritesModal);

  document.getElementById('fabBtn').addEventListener('click', () => {
    document.getElementById('fabMenuDropdown').classList.toggle('active');
  });

  document.querySelectorAll('.fab-menu-item').forEach(item => {
    item.addEventListener('click', () => {
      const type = item.dataset.addType;
      document.getElementById('fabMenuDropdown').classList.remove('active');
      if (type === 'category') {
        document.getElementById('categoryModal').classList.add('active');
        document.getElementById('categoryName').value = '';
        document.querySelectorAll('.cat-type-btn').forEach(b => b.classList.remove('active'));
        document.querySelector('.cat-type-btn[data-cat-type="material"]').classList.add('active');
      } else {
        selectedType = type;
        openAddForm();
      }
    });
  });

  document.addEventListener('click', (e) => {
    const fabMenu = document.getElementById('fabMenuDropdown');
    const fab = document.getElementById('fabBtn');
    if (!fabMenu.contains(e.target) && !fab.contains(e.target)) {
      fabMenu.classList.remove('active');
    }
  });

  document.getElementById('closeCategoryForm').addEventListener('click', () => {
    document.getElementById('categoryModal').classList.remove('active');
  });

  document.querySelectorAll('.cat-type-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.cat-type-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  document.getElementById('categoryForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const name = document.getElementById('categoryName').value.trim();
    const type = document.querySelector('.cat-type-btn.active').dataset.catType;
    if (!name) { alert('‚ö†Ô∏è Veuillez entrer un nom'); return; }
    items.push({ id: 'cat_' + Date.now(), type: type, category: name, name: '[Cat√©gorie: ' + name + ']', isCategory: true });
    localStorage.setItem('thecraft-items', JSON.stringify(items));
    document.getElementById('categoryModal').classList.remove('active');
    alert('‚úÖ Cat√©gorie "' + name + '" cr√©√©e');
    render();
  });

  document.getElementById('searchBtn').addEventListener('click', openSearch);
  document.getElementById('closeSearch').addEventListener('click', closeSearch);
  document.getElementById('searchInput').addEventListener('input', performSearch);
  document.getElementById('closeAddForm').addEventListener('click', closeAddForm);
  document.getElementById('addForm').addEventListener('submit', submitForm);
  document.getElementById('closeFavorites').addEventListener('click', closeFavoritesModal);
  document.getElementById('closeDetailBtn').addEventListener('click', closeDetailModal);

  document.getElementById('deleteBtn').addEventListener('click', () => {
    if (!editingId) return;
    if (confirm('√ätes-vous s√ªr de vouloir supprimer cet √©l√©ment ?')) {
      items = items.filter(i => i.id !== editingId);
      localStorage.setItem('thecraft-items', JSON.stringify(items));
      closeAddForm();
      render();
      alert('‚úÖ √âl√©ment supprim√©');
    }
  });

  document.getElementById('imageUploadArea').addEventListener('click', () => {
    document.getElementById('imageUpload').click();
  });
  document.getElementById('imageUpload').addEventListener('change', handleImageUpload);

  document.querySelectorAll('.tab-item[data-tab]').forEach(btn => {
    btn.addEventListener('click', () => switchTab(btn.dataset.tab));
  });

  document.getElementById('addModal').addEventListener('click', e => {
    if (e.target.id === 'addModal') closeAddForm();
  });

  document.addEventListener('click', e => {
    const menu = document.getElementById('menu');
    const btn = document.getElementById('menuBtn');
    if (!menu.contains(e.target) && !btn.contains(e.target)) {
      menu.classList.remove('active');
    }
  });
}

function loadDaily() {
  const today = new Date().toDateString();
  const stored = localStorage.getItem('daily-suggestions');
  if (stored) {
    const data = JSON.parse(stored);
    if (data.date === today && data.ids && data.ids.length > 0) {
      daily = data.ids;
      return;
    }
  }
  const realItems = items.filter(i => !i.isCategory);
  if (realItems.length === 0) { daily = []; return; }
  const shuffled = [...realItems].sort(() => Math.random() - 0.5);
  daily = shuffled.slice(0, Math.min(6, realItems.length)).map(i => i.id);
  localStorage.setItem('daily-suggestions', JSON.stringify({ date: today, ids: daily }));
}

function render() {
  renderHome();
  renderSuppliers();
  renderMaterials();
}

function renderHome() {
  const realItems = items.filter(i => !i.isCategory);
  const latest = [...realItems].sort((a, b) => b.updatedAt - a.updatedAt).slice(0, 5);
  document.getElementById('latest').innerHTML = latest.map(i => `
    <div class="h-card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite ? '‚ù§Ô∏è' : '‚ô°'}</div>
      <img src="${i.image}">
      <div class="overlay">
        <div class="tag">${i.category || 'Sans cat√©gorie'}</div>
        <h3>${i.name}</h3>
      </div>
    </div>
  `).join('');

  const favs = realItems.filter(i => i.favorite).slice(0, 6);
  document.getElementById('favorites').innerHTML = favs.length ? favs.map(i => `
    <div class="card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">‚ù§Ô∏è</div>
      <img src="${i.image}">
      <div class="overlay">
        <div class="tag">${i.category || 'Sans cat√©gorie'}</div>
        <h3>${i.name}</h3>
      </div>
    </div>
  `).join('') : '<div class="empty"><h3>Aucun coup de c≈ìur</h3></div>';

  const dailyItems = realItems.filter(i => daily.includes(i.id));
  document.getElementById('daily').innerHTML = dailyItems.length > 0 ? dailyItems.map(i => `
    <div class="card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite ? '‚ù§Ô∏è' : '‚ô°'}</div>
      <img src="${i.image}">
      <div class="overlay">
        <div class="tag">${i.category || 'Sans cat√©gorie'}</div>
        <h3>${i.name}</h3>
      </div>
    </div>
  `).join('') : '<div class="empty"><h3>Aucune d√©couverte</h3><p>Importez vos donn√©es pour voir des suggestions</p></div>';

  bindCardEvents();
}

function bindCardEvents() {
  document.querySelectorAll('.fav-btn').forEach(btn => {
    btn.addEventListener('click', e => { e.stopPropagation(); toggleFav(btn.dataset.id); });
  });
  document.querySelectorAll('.h-card, .card, .material-card, .disc-card, .pint-item').forEach(card => {
    if (card.dataset.itemId) {
      card.addEventListener('click', e => {
        if (!e.target.classList.contains('fav-btn') && !e.target.closest('.fav-btn')) {
          showDetailModal(card.dataset.itemId);
        }
      });
    }
  });
}

function renderSuppliers() {
  const sups = items.filter(i => i.type === 'supplier' && !i.isCategory);
  const cats = ['Tous', ...new Set(sups.map(i => i.category).filter(Boolean))];

  document.getElementById('cat-suppliers').innerHTML = cats.map(c =>
    `<div class="cat-chip ${c === activeCategorySuppliers ? 'active' : ''}" data-category="${c}">${c}</div>`
  ).join('');

  document.querySelectorAll('#cat-suppliers .cat-chip').forEach(chip => {
    chip.addEventListener('click', () => { activeCategorySuppliers = chip.dataset.category; renderSuppliers(); });
  });

  const today = new Date().toDateString();
  let dailySeed = localStorage.getItem('daily-suppliers-seed');
  let dailySeedDate = localStorage.getItem('daily-suppliers-date');
  if (dailySeedDate !== today) {
    dailySeed = Math.random().toString();
    localStorage.setItem('daily-suppliers-seed', dailySeed);
    localStorage.setItem('daily-suppliers-date', today);
  }
  const seededRandom = (seed, index) => { const x = Math.sin(parseFloat(seed) + index) * 10000; return x - Math.floor(x); };
  const rand = sups.map((s, i) => ({ item: s, seed: seededRandom(dailySeed, i) })).sort((a, b) => a.seed - b.seed).slice(0, 5).map(s => s.item);

  document.getElementById('disc-suppliers').innerHTML = rand.map(i => `
    <div class="disc-card" data-item-id="${i.id}">
      <img src="${i.image}">
      <div class="name"><h4>${i.name}</h4></div>
    </div>
  `).join('');

  const filtered = activeCategorySuppliers === 'Tous' ? sups : sups.filter(i => i.category === activeCategorySuppliers);
  document.getElementById('pint-suppliers').innerHTML = filtered.map(i => `
    <div class="material-card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite ? '‚ù§Ô∏è' : '‚ô°'}</div>
      <img src="${i.image}" alt="${i.name}">
      <div class="overlay"><h3>${i.name}</h3></div>
    </div>
  `).join('');

  bindCardEvents();
}

function renderMaterials() {
  const mats = items.filter(i => i.type === 'material' && !i.isCategory);
  const cats = ['Tous', ...new Set(mats.map(i => i.category).filter(Boolean))];

  document.getElementById('cat-materials').innerHTML = cats.map(c =>
    `<div class="cat-chip ${c === activeCategoryMaterials ? 'active' : ''}" data-category="${c}">${c}</div>`
  ).join('');

  document.querySelectorAll('#cat-materials .cat-chip').forEach(chip => {
    chip.addEventListener('click', () => { activeCategoryMaterials = chip.dataset.category; renderMaterials(); });
  });

  const today = new Date().toDateString();
  let dailySeed = localStorage.getItem('daily-materials-seed');
  let dailySeedDate = localStorage.getItem('daily-materials-date');
  if (dailySeedDate !== today) {
    dailySeed = Math.random().toString();
    localStorage.setItem('daily-materials-seed', dailySeed);
    localStorage.setItem('daily-materials-date', today);
  }
  const seededRandom = (seed, index) => { const x = Math.sin(parseFloat(seed) + index) * 10000; return x - Math.floor(x); };
  const rand = mats.map((m, i) => ({ item: m, seed: seededRandom(dailySeed, i) })).sort((a, b) => a.seed - b.seed).slice(0, 5).map(m => m.item);

  document.getElementById('disc-materials').innerHTML = rand.map(i => `
    <div class="disc-card" data-item-id="${i.id}">
      <img src="${i.image}">
      <div class="name"><h4>${i.name}</h4></div>
    </div>
  `).join('');

  const filtered = activeCategoryMaterials === 'Tous' ? mats : mats.filter(i => i.category === activeCategoryMaterials);
  document.getElementById('pint-materials').innerHTML = filtered.map(i => `
    <div class="material-card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite ? '‚ù§Ô∏è' : '‚ô°'}</div>
      <img src="${i.image}" alt="${i.name}">
      <div class="overlay"><h3>${i.name}</h3></div>
    </div>
  `).join('');

  bindCardEvents();
}

function toggleMenu() { document.getElementById('menu').classList.toggle('active'); }

function toggleFav(id) {
  const item = items.find(i => i.id === id);
  if (item) { item.favorite = !item.favorite; localStorage.setItem('thecraft-items', JSON.stringify(items)); render(); }
}

function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
  document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function openSearch() {
  document.getElementById('searchModal').classList.add('active');
  document.getElementById('searchInput').focus();
  document.body.classList.add('modal-open');
}
function closeSearch() {
  document.getElementById('searchModal').classList.remove('active');
  document.getElementById('searchInput').value = '';
  document.getElementById('searchResults').innerHTML = '';
  document.body.classList.remove('modal-open');
}

function performSearch() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const results = document.getElementById('searchResults');
  if (query.length < 1) { results.innerHTML = ''; return; }
  const found = items.filter(i => !i.isCategory && (i.name.toLowerCase().includes(query) || (i.category && i.category.toLowerCase().includes(query))));
  if (found.length === 0) {
    results.innerHTML = '<div class="empty"><h3>Aucun r√©sultat</h3></div>';
  } else {
    results.innerHTML = `<div class="pinterest">${found.map((i, idx) => `
      <div class="pint-item ${idx % 2 === 0 ? 'tall' : 'short'}" data-item-id="${i.id}">
        <div class="fav-btn" data-id="${i.id}">${i.favorite ? '‚ù§Ô∏è' : '‚ô°'}</div>
        <img src="${i.image}">
        <div class="info">
          <h3>${i.name}</h3>
          ${i.category ? `<div class="tag">${i.category}</div>` : ''}
          ${i.price ? `<div class="price">${i.price}</div>` : ''}
        </div>
      </div>
    `).join('')}</div>`;
    bindCardEvents();
  }
}

function showDetailModal(itemId) {
  const item = items.find(i => i.id === itemId);
  if (!item) return;
  const modal = document.getElementById('detailModal');
  const body = document.getElementById('detailBody');
  const metaTags = [];
  if (item.category) metaTags.push(`<span class="meta-tag">${item.category}</span>`);
  if (item.price) metaTags.push(`<span class="meta-tag">${item.price}</span>`);
  const details = [];
  if (item.contact) details.push(`<p><strong>Fournisseur :</strong> ${item.contact}</p>`);
  if (item.phone) details.push(`<p><strong>T√©l√©phone :</strong> ${item.phone}</p>`);
  if (item.email) details.push(`<p><strong>Email :</strong> ${item.email}</p>`);
  if (item.website) details.push(`<p><strong>Site web :</strong> <a href="${item.website}" target="_blank" style="color:var(--accent)">${item.website}</a></p>`);
  if (item.description) details.push(`<p><strong>Description :</strong> ${item.description}</p>`);
  body.innerHTML = `
    ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ''}
    <div class="detail-info">
      <h1>${item.name}</h1>
      ${metaTags.length > 0 ? `<div class="detail-meta">${metaTags.join('')}</div>` : ''}
      ${details.join('')}
    </div>
    <div class="detail-actions">
      <button class="edit-btn" id="editItemBtn">Modifier</button>
    </div>
  `;
  modal.classList.add('active');
  setTimeout(() => {
    document.getElementById('editItemBtn').addEventListener('click', () => { closeDetailModal(); editItem(item.id); });
  }, 0);
}
function closeDetailModal() { document.getElementById('detailModal').classList.remove('active'); }

function openFavoritesModal() {
  const favs = items.filter(i => i.favorite && !i.isCategory);
  const modal = document.getElementById('favoritesModal');
  const list = document.getElementById('favoritesList');
  if (favs.length === 0) {
    list.innerHTML = `<div class="favorites-empty"><h2>Aucun favori</h2><p>Ajoutez vos mat√©riaux et fournisseurs pr√©f√©r√©s en cliquant sur le c≈ìur ‚ô°</p></div>`;
  } else {
    list.innerHTML = favs.map(item => `
      <div class="favorite-slide">
        <img src="${item.image}" alt="${item.name}">
        <div class="info-overlay">
          <div class="badge">${item.type === 'material' ? 'MAT√âRIAU' : 'FOURNISSEUR'}</div>
          <h2>${item.name}</h2>
          ${item.contact ? `<p class="supplier">${item.contact}</p>` : ''}
          ${item.description ? `<p class="description">${item.description}</p>` : ''}
          ${item.category || item.price ? `<p class="description">${item.category || ''}${item.category && item.price ? ' ‚Ä¢ ' : ''}${item.price || ''}</p>` : ''}
        </div>
      </div>
    `).join('');
  }
  modal.classList.add('active');
  document.body.classList.add('modal-open');
  toggleMenu();
}
function closeFavoritesModal() {
  document.getElementById('favoritesModal').classList.remove('active');
  document.body.classList.remove('modal-open');
}

function handleImageUpload(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (event) => {
    uploadedImageUrl = event.target.result;
    const uploadDiv = document.getElementById('imageUploadArea');
    uploadDiv.innerHTML = `<img src="${uploadedImageUrl}" alt="Preview">`;
    uploadDiv.classList.add('has-image');
  };
  reader.readAsDataURL(file);
}

function openAddForm() {
  editingId = null;
  uploadedImageUrl = '';
  const typeName = selectedType === 'material' ? 'mat√©riau' : 'fournisseur';
  document.getElementById('formTitle').textContent = 'Ajouter un ' + typeName;
  document.getElementById('submitBtn').textContent = 'Cr√©er';
  document.getElementById('addForm').reset();
  const uploadDiv = document.getElementById('imageUploadArea');
  uploadDiv.innerHTML = `<svg viewBox="0 0 24 24" width="40" height="40" stroke="currentColor" fill="none" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg><p>Ajouter une photo</p>`;
  uploadDiv.classList.remove('has-image');
  document.querySelectorAll('.material-only').forEach(el => { el.style.display = selectedType === 'material' ? 'block' : 'none'; });
  document.querySelectorAll('.supplier-only').forEach(el => { el.style.display = selectedType === 'supplier' ? 'block' : 'none'; });
  generateCategoryChips();
  generateSupplierChips();
  document.getElementById('addModal').classList.add('active');
  document.getElementById('deleteBtn').style.display = 'none';
}
function closeAddForm() {
  document.getElementById('addModal').classList.remove('active');
  document.getElementById('addForm').reset();
  uploadedImageUrl = '';
  editingId = null;
}

function generateSupplierChips() {
  const suppliers = items.filter(i => i.type === 'supplier' && !i.isCategory);
  const container = document.getElementById('supplierChips');
  if (!container) return;
  let html = '<div class="supplier-chip" data-supplier="">Aucun</div>';
  suppliers.forEach(s => { html += `<div class="supplier-chip" data-supplier="${s.name}">${s.name}</div>`; });
  container.innerHTML = html;
  container.querySelectorAll('.supplier-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      container.querySelectorAll('.supplier-chip').forEach(c => c.classList.remove('selected'));
      chip.classList.add('selected');
      document.getElementById('itemSupplier').value = chip.dataset.supplier;
    });
  });
  container.querySelector('.supplier-chip').classList.add('selected');
}

function generateCategoryChips() {
  const relevantItems = items.filter(i => i.type === selectedType);
  const categories = [...new Set(relevantItems.map(i => i.category).filter(Boolean))];
  const container = document.getElementById('categoryChips');
  if (!container) return;
  let html = '<div class="category-chip" data-category="">Sans cat√©gorie</div>';
  categories.sort().forEach(c => { html += `<div class="category-chip" data-category="${c}">${c}</div>`; });
  container.innerHTML = html;
  container.querySelectorAll('.category-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      container.querySelectorAll('.category-chip').forEach(c => c.classList.remove('selected'));
      chip.classList.add('selected');
      document.getElementById('itemCategory').value = chip.dataset.category;
    });
  });
  container.querySelector('.category-chip').classList.add('selected');
}

function submitForm(e) {
  e.preventDefault();
  const itemData = {
    type: selectedType,
    name: document.getElementById('itemName').value,
    category: document.getElementById('itemCategory').value,
    description: document.getElementById('itemDescription').value,
    image: uploadedImageUrl || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23' + Math.floor(Math.random() * 16777215).toString(16).padStart(6, '0') + '" width="400" height="300"/%3E%3C/svg%3E',
    favorite: false,
    updatedAt: Date.now()
  };
  if (selectedType === 'material') {
    itemData.contact = document.getElementById('itemSupplier').value;
    itemData.price = document.getElementById('itemPrice').value;
  }
  if (selectedType === 'supplier') {
    itemData.phone = document.getElementById('itemPhone').value;
    itemData.email = document.getElementById('itemEmail').value;
    itemData.website = document.getElementById('itemWebsite').value;
  }
  if (editingId) {
    const index = items.findIndex(i => i.id === editingId);
    if (index !== -1) { items[index] = { ...items[index], ...itemData }; alert('‚úÖ Modifi√© !'); }
  } else {
    itemData.id = Date.now().toString();
    itemData.createdAt = Date.now();
    items.push(itemData);
    alert('‚úÖ Ajout√© !');
  }
  localStorage.setItem('thecraft-items', JSON.stringify(items));
  render();
  closeAddForm();
  switchTab(selectedType === 'material' ? 'materials' : 'suppliers');
}

function editItem(id) {
  const item = items.find(i => i.id === id);
  if (!item) return;
  editingId = id;
  selectedType = item.type;
  uploadedImageUrl = item.image || '';
  const typeName = selectedType === 'material' ? 'mat√©riau' : 'fournisseur';
  document.getElementById('formTitle').textContent = 'Modifier le ' + typeName;
  document.getElementById('submitBtn').textContent = 'Enregistrer';
  document.getElementById('itemName').value = item.name || '';
  document.getElementById('itemCategory').value = item.category || '';
  document.getElementById('itemDescription').value = item.description || '';

  document.querySelectorAll('.material-only').forEach(el => { el.style.display = item.type === 'material' ? 'block' : 'none'; });
  document.querySelectorAll('.supplier-only').forEach(el => { el.style.display = item.type === 'supplier' ? 'block' : 'none'; });

  generateCategoryChips();
  if (item.type === 'material') {
    generateSupplierChips();
    document.getElementById('itemSupplier').value = item.contact || '';
    document.getElementById('itemPrice').value = item.price || '';
  }
  if (item.type === 'supplier') {
    document.getElementById('itemPhone').value = item.phone || '';
    document.getElementById('itemEmail').value = item.email || '';
    document.getElementById('itemWebsite').value = item.website || '';
  }

  setTimeout(() => {
    document.querySelectorAll('.category-chip').forEach(chip => {
      chip.classList.remove('selected');
      if (chip.dataset.category === (item.category || '')) chip.classList.add('selected');
    });
    if (item.type === 'material') {
      document.querySelectorAll('.supplier-chip').forEach(chip => {
        chip.classList.remove('selected');
        if (chip.dataset.supplier === (item.contact || '')) chip.classList.add('selected');
      });
    }
  }, 10);

  if (uploadedImageUrl) {
    const uploadDiv = document.getElementById('imageUploadArea');
    uploadDiv.innerHTML = `<img src="${uploadedImageUrl}" alt="Preview">`;
    uploadDiv.classList.add('has-image');
  }
  document.getElementById('addModal').classList.add('active');
  document.getElementById('deleteBtn').style.display = 'block';
}

function syncToiCloud() {
  toggleMenu();
  const materials = items.filter(i => i.type === 'material' && !i.isCategory);
  const suppliers = items.filter(i => i.type === 'supplier' && !i.isCategory);
  localStorage.setItem('thecraft-items', JSON.stringify(items));
  const blobMat = new Blob([JSON.stringify(materials, null, 2)], { type: 'application/json' });
  const urlMat = URL.createObjectURL(blobMat);
  const aMat = document.createElement('a');
  aMat.href = urlMat; aMat.download = 'materials.json'; aMat.click();
  URL.revokeObjectURL(urlMat);
  setTimeout(() => {
    const blobSup = new Blob([JSON.stringify(suppliers, null, 2)], { type: 'application/json' });
    const urlSup = URL.createObjectURL(blobSup);
    const aSup = document.createElement('a');
    aSup.href = urlSup; aSup.download = 'suppliers.json'; aSup.click();
    URL.revokeObjectURL(urlSup);
    alert('‚òÅÔ∏è Sync iCloud\n\n‚úÖ 2 fichiers t√©l√©charg√©s\nüì¶ ' + materials.length + ' mat√©riaux\nüè¢ ' + suppliers.length + ' fournisseurs\n\nüìç IMPORTANT :\n1. Va dans Fichiers ‚Üí T√©l√©chargements\n2. S√©lectionne les 2 fichiers\n3. D√©place vers :\n   iCloud Drive/TheCraftLibrary/Base de donn√©es/\n4. Remplace les anciens');
  }, 500);
}

function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const newItems = JSON.parse(ev.target.result);
        let added = 0, updated = 0;
        newItems.forEach(newItem => {
          const idx = items.findIndex(i => i.id === newItem.id);
          if (idx >= 0) { items[idx] = newItem; updated++; }
          else { items.push(newItem); added++; }
        });
        localStorage.setItem('thecraft-items', JSON.stringify(items));
        loadDaily();
        render();
        let msg = '‚úÖ Import r√©ussi !\n';
        if (added > 0) msg += added + ' nouveaux\n';
        if (updated > 0) msg += updated + ' mis √† jour\n';
        msg += 'Total : ' + items.length;
        alert(msg);
      } catch (err) {
        alert('‚ùå Erreur: fichier JSON invalide');
        console.error(err);
      }
    };
    reader.readAsText(file);
  };
  input.click();
  toggleMenu();
}

init();
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('‚úÖ Service Worker enregistr√©:', reg.scope))
      .catch(err => console.log('‚ùå Erreur Service Worker:', err));
  });
}
</script>
</body>
</html>

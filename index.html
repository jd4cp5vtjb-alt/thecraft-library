<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>TheCraft Library V3</title>
<style>
:root {
  --bg-start: #4A9EFF;
  --bg-end: #A8D5FF;
  --card-bg: rgba(255,255,255,0.2);
  --text: #FFFFFF;
  --shadow: rgba(0,0,0,0.15);
}
* { margin:0; padding:0; box-sizing:border-box; font-family:-apple-system,sans-serif; }
body { background:linear-gradient(135deg, var(--bg-start), var(--bg-end)); min-height:100vh; color:var(--text); padding-bottom:100px; }

.menu-btn { position:fixed; top:20px; right:20px; width:44px; height:44px; background:rgba(255,255,255,0.2); backdrop-filter:blur(20px); border-radius:50%; border:none; cursor:pointer; z-index:1000; display:flex; flex-direction:column; gap:5px; align-items:center; justify-content:center; }
.menu-btn span { width:20px; height:2.5px; background:#fff; border-radius:2px; }
.menu-dropdown { position:fixed; top:75px; right:20px; background:rgba(255,255,255,0.25); backdrop-filter:blur(30px); border-radius:16px; padding:8px; z-index:999; display:none; min-width:180px; }
.menu-dropdown.active { display:block; }
.menu-item { padding:12px 16px; border-radius:10px; cursor:pointer; color:#fff; font-weight:600; }
.menu-item:hover { background:rgba(255,255,255,0.2); }

.page-header { padding:24px 20px 8px; }
.page-subtitle { font-size:0.8em; opacity:0.85; text-transform:uppercase; letter-spacing:1.2px; margin-bottom:6px; }
.page-title { font-size:2.2em; font-weight:900; letter-spacing:-0.8px; }

.section-title { font-size:1.5em; font-weight:800; padding:0 20px; margin:32px 0 16px; }

.scroll-h { overflow-x:auto; -webkit-overflow-scrolling:touch; margin-bottom:32px; }
.scroll-h::-webkit-scrollbar { display:none; }
.scroll-h .cards { display:flex; gap:16px; padding:0 20px; }

.h-card { min-width:280px; height:340px; border-radius:24px; background:var(‚Äìcard-bg); backdrop-filter:blur(20px); position:relative; cursor:pointer; transition:transform 0.3s; overflow:hidden; flex-shrink:0; }
.h-card:hover { transform:translateY(-6px); }
.h-card img { width:100%; height:100%; object-fit:cover; }
.h-card .overlay { position:absolute; bottom:0; left:0; right:0; padding:24px 20px; background:linear-gradient(to top, rgba(0,0,0,0.85), transparent); }
.h-card h3 { font-size:1.3em; font-weight:800; }

.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:16px; padding:0 20px; margin-bottom:32px; }
.card { min-height:340px; border-radius:24px; background:var(‚Äìcard-bg); backdrop-filter:blur(20px); position:relative; cursor:pointer; transition:transform 0.3s; overflow:hidden; }
.card:hover { transform:translateY(-6px); }
.card img { width:100%; height:100%; object-fit:cover; }
.card .overlay { position:absolute; bottom:0; left:0; right:0; padding:28px 20px; background:linear-gradient(to top, rgba(0,0,0,0.85), transparent); }
.card h3 { font-size:1.5em; font-weight:800; }
.card .tag { font-size:0.7em; text-transform:uppercase; background:rgba(255,255,255,0.2); padding:5px 10px; border-radius:8px; display:inline-block; margin-bottom:8px; }

.fav-btn { position:absolute; top:16px; right:16px; font-size:1.6em; cursor:pointer; z-index:10; filter:drop-shadow(0 2px 8px rgba(0,0,0,0.3)); user-select:none; }
.fav-btn:hover { transform:scale(1.15); }

.cats { overflow-x:auto; padding:16px 0; margin-bottom:24px; }
.cats::-webkit-scrollbar { display:none; }
.cats .list { display:flex; gap:10px; padding:0 20px; }
.cat-chip { padding:10px 18px; border-radius:20px; background:rgba(255,255,255,0.22); border:1px solid rgba(255,255,255,0.25); font-size:0.9em; font-weight:600; cursor:pointer; white-space:nowrap; }
.cat-chip:hover { background:rgba(255,255,255,0.35); }
.cat-chip.active { background:rgba(255,255,255,0.45); border-color:#fff; }

.pinterest { padding:0 16px; column-count:2; column-gap:16px; }
@media (min-width:600px) { .pinterest { column-count:3; } }
.pint-item { break-inside:avoid; margin-bottom:16px; background:var(‚Äìcard-bg); backdrop-filter:blur(20px); border-radius:20px; overflow:hidden; cursor:pointer; display:inline-block; width:100%; position:relative; transition:transform 0.3s; }
.pint-item:hover { transform:translateY(-6px); }
.pint-item img { width:100%; display:block; object-fit:cover; }
.pint-item.tall img { height:280px; }
.pint-item.short img { height:180px; }
.pint-item .info { padding:14px; }
.pint-item h3 { font-size:1em; font-weight:700; margin-bottom:8px; }
.pint-item .tag { background:rgba(74,158,255,0.15); padding:5px 11px; border-radius:8px; font-size:0.7em; color:#2B7FDB; font-weight:600; display:inline-block; margin-bottom:6px; }
.pint-item .price { font-size:0.9em; font-weight:700; margin-top:6px; background:rgba(255,255,255,0.2); padding:6px 12px; border-radius:8px; display:inline-block; }

.discover { margin-bottom:32px; }
.discover h2 { font-size:1.5em; font-weight:800; padding:0 20px; margin-bottom:16px; }
.discover .scroll { overflow-x:auto; }
.discover .scroll::-webkit-scrollbar { display:none; }
.discover .list { display:flex; gap:16px; padding:0 20px; }
.disc-card { min-width:240px; height:280px; border-radius:20px; background:var(‚Äìcard-bg); backdrop-filter:blur(20px); position:relative; cursor:pointer; overflow:hidden; transition:transform 0.3s; flex-shrink:0; }
.disc-card:hover { transform:translateY(-4px); }
.disc-card img { width:100%; height:100%; object-fit:cover; }
.disc-card .name { position:absolute; bottom:0; left:0; right:0; padding:20px 16px; background:linear-gradient(to top, rgba(0,0,0,0.8), transparent); }
.disc-card h4 { font-size:1.1em; font-weight:700; }

.tab-bar { position:fixed; bottom:20px; left:20px; right:20px; background:rgba(255,255,255,0.18); backdrop-filter:blur(30px); border-radius:28px; display:flex; justify-content:space-around; padding:12px 10px; z-index:100; }
.tab-item { display:flex; flex-direction:column; align-items:center; padding:10px 14px; border-radius:18px; cursor:pointer; background:transparent; border:none; color:rgba(255,255,255,0.65); min-width:65px; }
.tab-item.active { background:rgba(255,255,255,0.2); color:#fff; }
.tab-item svg { width:24px; height:24px; stroke:currentColor; fill:none; stroke-width:2.5; }
.tab-item span { font-size:0.65em; margin-top:6px; font-weight:600; }

.fab { position:fixed; bottom:120px; right:24px; width:60px; height:60px; border-radius:50%; background:linear-gradient(135deg, #4A9EFF, #60A5FA); border:none; color:#fff; font-size:28px; cursor:pointer; z-index:99; box-shadow:0 8px 32px rgba(74,158,255,0.4); }
.fab:active { transform:scale(0.95); }

.tab-content { display:none; }
.tab-content.active { display:block; }

.empty { text-align:center; padding:80px 20px; opacity:0.7; }
.empty h3 { font-size:1.3em; margin-bottom:10px; }

.search-modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:linear-gradient(135deg, var(‚Äìbg-start), var(‚Äìbg-end)); z-index:2000; padding:20px; padding-top:70px; }
.search-modal.active { display:block; }
.search-header { display:flex; gap:12px; margin-bottom:20px; }
.search-header input { flex:1; padding:14px 18px; border-radius:16px; border:1px solid rgba(255,255,255,0.25); background:rgba(255,255,255,0.2); color:#fff; font-size:1em; }
.search-header input::placeholder { color:rgba(255,255,255,0.65); }
.search-header button { background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.25); padding:12px 20px; border-radius:14px; color:#fff; font-weight:600; cursor:pointer; }
.search-results { padding:20px; }

.modal-overlay { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); z-index:3000; }
.modal-overlay.active { display:flex; align-items:flex-end; justify-content:center; }
.add-form { background:rgba(255,255,255,0.97); backdrop-filter:blur(40px); width:100%; max-width:500px; border-radius:28px 28px 0 0; padding:28px; max-height:90vh; overflow-y:auto; }
.add-form .form-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; }
.add-form .form-header h2 { font-size:1.4em; font-weight:800; color:#1C1C1E; }
.add-form .form-header button { background:rgba(0,0,0,0.08); border:none; width:36px; height:36px; border-radius:50%; font-size:1.1em; cursor:pointer; color:#3c3c43; }
.form-group { margin-bottom:20px; }
.form-group label { display:block; font-size:0.85em; font-weight:600; color:#3c3c43; margin-bottom:8px; }
.form-group input, .form-group select, .form-group textarea { width:100%; padding:14px 16px; border-radius:14px; border:1px solid rgba(0,0,0,0.1); font-size:1em; background:rgba(255,255,255,0.8); }
.form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline:none; border-color:#4A9EFF; }
.form-group textarea { resize:vertical; min-height:80px; }
.type-selector { display:flex; gap:12px; margin-bottom:24px; }
.type-btn { flex:1; padding:14px; border:2px solid rgba(74,158,255,0.25); background:rgba(255,255,255,0.5); border-radius:14px; font-size:0.95em; font-weight:600; cursor:pointer; color:#3c3c43; }
.type-btn.active { border-color:#4A9EFF; background:rgba(74,158,255,0.15); color:#4A9EFF; }
.submit-btn { width:100%; padding:18px; background:linear-gradient(135deg, #4A9EFF, #60A5FA); color:#fff; border:none; border-radius:16px; font-size:1.05em; font-weight:700; cursor:pointer; margin-top:12px; }
.submit-btn:active { transform:scale(0.98); }

.favorites-modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.3); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); z-index:3000; padding:40px 0 100px; }
.favorites-modal.active { display:flex; align-items:center; justify-content:center; }
.favorites-close { position:fixed; top:20px; right:20px; width:44px; height:44px; background:rgba(255,255,255,0.25); backdrop-filter:blur(20px); border-radius:50%; border:none; font-size:1.3em; color:#fff; cursor:pointer; z-index:3001; display:flex; align-items:center; justify-content:center; }
.favorites-close:active { transform:scale(0.95); }
.favorites-scroll { width:100%; max-width:100vw; height:100%; overflow-x:auto; overflow-y:hidden; -webkit-overflow-scrolling:touch; scroll-snap-type:x mandatory; }
.favorites-scroll::-webkit-scrollbar { display:none; }
.favorites-list { display:flex; height:100%; align-items:center; padding:0 20px; }
.favorite-slide { min-width:calc(100vw - 80px); width:calc(100vw - 80px); height:85vh; margin:0 20px; display:flex; flex-direction:column; scroll-snap-align:center; position:relative; border-radius:24px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,0.4); flex-shrink:0; }
.favorite-slide img { width:100%; height:100%; object-fit:cover; position:absolute; top:0; left:0; }
.favorite-slide .info-overlay { position:absolute; bottom:0; left:0; right:0; padding:32px 24px; padding-bottom:calc(32px + env(safe-area-inset-bottom)); background:linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 40%, rgba(0,0,0,0.3) 70%, transparent 100%); }
.favorite-slide .badge { display:inline-block; background:rgba(255,255,255,0.25); backdrop-filter:blur(10px); padding:6px 14px; border-radius:12px; font-size:0.75em; text-transform:uppercase; letter-spacing:1px; font-weight:700; margin-bottom:12px; color:#fff; }
.favorite-slide h2 { font-size:2em; font-weight:900; margin-bottom:8px; color:#fff; text-shadow:0 2px 8px rgba(0,0,0,0.5); }
.favorite-slide .supplier { font-size:1.1em; opacity:0.9; font-weight:600; margin-bottom:12px; color:#fff; }
.favorite-slide .description { font-size:0.95em; opacity:0.85; line-height:1.5; color:#fff; margin-bottom:8px; }
.favorites-empty { display:flex; align-items:center; justify-content:center; height:100%; width:100%; flex-direction:column; padding:40px; text-align:center; }
.favorites-empty h2 { font-size:2em; font-weight:900; margin-bottom:16px; color:#fff; }
.favorites-empty p { font-size:1.1em; opacity:0.8; color:#fff; }

.detail-modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); backdrop-filter:blur(10px); z-index:4000; overflow-y:auto; }
.detail-modal.active { display:block; }
.detail-content { background:var(‚Äìdetail-bg); margin:60px 20px; border-radius:28px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,0.4); }
.detail-header { position:sticky; top:0; background:var(‚Äìdetail-bg); backdrop-filter:blur(30px); padding:16px 20px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(‚Äìborder-color); z-index:100; }
.detail-header h2 { font-size:1.1em; font-weight:700; color:var(‚Äìdetail-text); }
.detail-header button { background:var(‚Äìtag-bg); border:1px solid var(‚Äìtag-border); border-radius:12px; width:38px; height:38px; font-size:1.3em; color:var(‚Äìtag-color); cursor:pointer; display:flex; align-items:center; justify-content:center; }
.detail-content img { width:100%; max-height:400px; object-fit:cover; }
.detail-info { padding:28px; }
.detail-info h1 { font-size:2em; font-weight:800; margin-bottom:14px; color:var(‚Äìdetail-text); }
.detail-meta { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
.detail-meta .meta-tag { background:var(‚Äìtag-bg); backdrop-filter:blur(10px); padding:8px 16px; border-radius:12px; font-size:0.9em; color:var(‚Äìtag-color); font-weight:600; border:1px solid var(‚Äìtag-border); }
.detail-info p { margin-bottom:16px; color:var(‚Äìdetail-text); font-size:1em; line-height:1.7; opacity:0.8; }
.detail-info strong { font-weight:700; opacity:1; }
.detail-actions { display:flex; gap:12px; padding:0 28px 32px; }
.detail-actions button { flex:1; padding:16px; border-radius:16px; border:none; font-size:1.05em; font-weight:700; cursor:pointer; }
.detail-actions .close-btn { background:var(‚Äìinput-bg); color:var(‚Äìdetail-text); }

@media (prefers-color-scheme: dark) {
.detail-content { background:rgba(28,28,30,0.97); }
.detail-header { background:rgba(28,28,30,0.97); }
.detail-info { color:#fff; }
.detail-info h1 { color:#fff; }
.detail-info p { color:#fff; }
.detail-actions .close-btn { background:rgba(58,58,60,0.85); color:#fff; }
}
</style>

</head>
<body>

<button class="menu-btn" id="menuBtn">
  <span></span>
  <span></span>
  <span></span>
</button>
<div class="menu-dropdown" id="menu">
  <div class="menu-item" id="exportBtn">üì§ Exporter</div>
  <div class="menu-item" id="importBtn">üì• Importer</div>
  <div class="menu-item" id="favBtn">‚ù§Ô∏è Favoris</div>
</div>

<main>
  <div class="tab-content active" id="home">
    <div class="page-header">
      <div class="page-subtitle">Biblioth√®que de mat√©riaux</div>
      <h1 class="page-title">TheCraft Library</h1>
    </div>
    <h2 class="section-title">Les derni√®res nouveaut√©s</h2>
    <div class="scroll-h"><div class="cards" id="latest"></div></div>
    <h2 class="section-title">Les coups de c≈ìur</h2>
    <div class="grid" id="favorites"></div>
    <h2 class="section-title">√Ä d√©couvrir aujourd'hui</h2>
    <div class="grid" id="daily"></div>
  </div>

  <div class="tab-content" id="suppliers">
    <div class="page-header">
      <div class="page-subtitle">Annuaire professionnel</div>
      <h1 class="page-title">Fournisseurs</h1>
    </div>
    <div class="discover">
      <h2>Les fournisseurs √† d√©couvrir</h2>
      <div class="scroll"><div class="list" id="disc-suppliers"></div></div>
    </div>
    <div class="cats"><div class="list" id="cat-suppliers"></div></div>
    <h2 class="section-title">Tous les fournisseurs</h2>
    <div class="pinterest" id="pint-suppliers"></div>
  </div>

  <div class="tab-content" id="materials">
    <div class="page-header">
      <div class="page-subtitle">Collection compl√®te</div>
      <h1 class="page-title">Mat√©riaux</h1>
    </div>
    <div class="discover">
      <h2>Les mat√©riaux √† d√©couvrir</h2>
      <div class="scroll"><div class="list" id="disc-materials"></div></div>
    </div>
    <div class="cats"><div class="list" id="cat-materials"></div></div>
    <h2 class="section-title">Tous les mat√©riaux</h2>
    <div class="pinterest" id="pint-materials"></div>
  </div>
</main>

<button class="fab" id="fabBtn">+</button>

<nav class="tab-bar">
  <button class="tab-item active" data-tab="home">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span>Accueil</span>
  </button>
  <button class="tab-item" data-tab="suppliers">
    <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>
    <span>Fournisseurs</span>
  </button>
  <button class="tab-item" data-tab="materials">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
    <span>Mat√©riaux</span>
  </button>
  <button class="tab-item" id="searchBtn">
    <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <span>Recherche</span>
  </button>
</nav>

<div class="search-modal" id="searchModal">
  <div class="search-header">
    <input type="text" placeholder="Rechercher..." id="searchInput">
    <button id="closeSearch">Annuler</button>
  </div>
  <div class="search-results" id="searchResults"></div>
</div>

<div class="modal-overlay" id="addModal">
  <div class="add-form">
    <div class="form-header">
      <h2 id="formTitle">Ajouter</h2>
      <button id="closeAddForm">‚úï</button>
    </div>

```
<div class="type-selector">
  <button class="type-btn active" data-type="material">Mat√©riau</button>
  <button class="type-btn" data-type="supplier">Fournisseur</button>
</div>

<form id="addForm">
  <div class="form-group">
    <label for="itemName">Nom *</label>
    <input type="text" id="itemName" required>
  </div>

  <div class="form-group">
    <label for="itemCategory">Cat√©gorie</label>
    <input type="text" id="itemCategory" placeholder="ex: Bois, Pierre, M√©tal...">
  </div>

  <div class="form-group">
    <label for="itemSupplier">Fournisseur</label>
    <input type="text" id="itemSupplier" placeholder="ex: Bois & Nature, Marbre Prestige...">
  </div>

  <div class="form-group">
    <label for="itemPrice">Prix</label>
    <input type="text" id="itemPrice" placeholder="ex: 150‚Ç¨/m¬≤">
  </div>

  <div class="form-group">
    <label for="itemDescription">Description</label>
    <textarea id="itemDescription" placeholder="Description..."></textarea>
  </div>

  <button type="submit" class="submit-btn">Cr√©er</button>
</form>
```

  </div>
</div>

<div class="favorites-modal" id="favoritesModal">
  <button class="favorites-close" id="closeFavorites">‚úï</button>
  <div class="favorites-scroll" id="favoritesScroll">
    <div class="favorites-list" id="favoritesList"></div>
  </div>
</div>

<div class="detail-modal" id="detailModal">
  <div class="detail-content">
    <div class="detail-header">
      <h2>D√©tails</h2>
      <button onclick="closeDetailModal()">‚úï</button>
    </div>
    <div id="detailBody"></div>
  </div>
</div>

<script>
let items = [
  {id:'1',type:'material',name:'Ch√™ne Massif',category:'Bois',price:'245‚Ç¨/m¬≤',contact:'Bois & Nature',description:'Bois de ch√™ne massif naturel',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23a0826d" width="400" height="300"/%3E%3C/svg%3E',favorite:true,createdAt:Date.now()-86400000*5,updatedAt:Date.now()-86400000*2},
  {id:'2',type:'supplier',name:'Bois & Nature',category:'Menuiserie',contact:'www.boisnature.fr',description:'Sp√©cialiste bois et parquets',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%238b4513" width="400" height="300"/%3E%3C/svg%3E',favorite:true,createdAt:Date.now()-86400000*3,updatedAt:Date.now()},
  {id:'3',type:'material',name:'Marbre Calacatta',category:'Pierre',price:'580‚Ç¨/m¬≤',contact:'Marbre Prestige',description:'Marbre italien avec veines dor√©es',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23f5f5f0" width="400" height="300"/%3E%3C/svg%3E',favorite:false,createdAt:Date.now()-86400000*7,updatedAt:Date.now()-86400000*7},
  {id:'4',type:'material',name:'Acier Inoxydable',category:'M√©tal',price:'180‚Ç¨/m¬≤',contact:'M√©tal Concept',description:'Acier inoxydable 304 bross√©',image:'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23b8c5d6" width="400" height="300"/%3E%3C/svg%3E',favorite:false,createdAt:Date.now()-86400000*1,updatedAt:Date.now()-86400000*1}
];

let daily = [];
let activeCategorySuppliers = 'Tous';
let activeCategoryMaterials = 'Tous';

function init() {
  loadDaily();
  render();
  setupEvents();
}

function setupEvents() {
  document.getElementById('menuBtn').addEventListener('click', toggleMenu);
  document.getElementById('exportBtn').addEventListener('click', exportData);
  document.getElementById('importBtn').addEventListener('click', importData);
  document.getElementById('favBtn').addEventListener('click', openFavoritesModal);
  document.getElementById('fabBtn').addEventListener('click', openAddForm);
  document.getElementById('searchBtn').addEventListener('click', openSearch);
  document.getElementById('closeSearch').addEventListener('click', closeSearch);
  document.getElementById('searchInput').addEventListener('input', performSearch);
  document.getElementById('closeAddForm').addEventListener('click', closeAddForm);
  document.getElementById('addForm').addEventListener('submit', submitForm);
  document.getElementById('closeFavorites').addEventListener('click', closeFavoritesModal);
  
  document.querySelectorAll('.tab-item[data-tab]').forEach(btn => {
    btn.addEventListener('click', () => switchTab(btn.dataset.tab));
  });

  document.querySelectorAll('.type-btn').forEach(btn => {
    btn.addEventListener('click', () => selectType(btn.dataset.type));
  });

  document.getElementById('addModal').addEventListener('click', e => {
    if (e.target.id === 'addModal') closeAddForm();
  });

  document.addEventListener('click', e => {
    const menu = document.getElementById('menu');
    const btn = document.getElementById('menuBtn');
    if (!menu.contains(e.target) && !btn.contains(e.target)) {
      menu.classList.remove('active');
    }
  });
}

function loadDaily() {
  const today = new Date().toDateString();
  const stored = localStorage.getItem('daily-suggestions');
  if (stored) {
    const data = JSON.parse(stored);
    if (data.date === today) {
      daily = data.ids;
      return;
    }
  }
  const nonFav = items.filter(i => !i.favorite);
  daily = nonFav.sort(() => Math.random()-0.5).slice(0,3).map(i => i.id);
  localStorage.setItem('daily-suggestions', JSON.stringify({date:today,ids:daily}));
}

function render() {
  renderHome();
  renderSuppliers();
  renderMaterials();
}

function renderHome() {
  const latest = [...items].sort((a,b) => b.updatedAt-a.updatedAt).slice(0,5);
  document.getElementById('latest').innerHTML = latest.map(i => `
    <div class="h-card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite?'‚ù§Ô∏è':'<span style="color:#fff">‚ô°</span>'}</div>
      <img src="${i.image}">
      <div class="overlay">
        <div class="tag">${i.category||'Sans cat√©gorie'}</div>
        <h3>${i.name}</h3>
      </div>
    </div>
  `).join('');

  const favs = items.filter(i => i.favorite).slice(0,3);
  document.getElementById('favorites').innerHTML = favs.length ? favs.map(i => `
    <div class="card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">‚ù§Ô∏è</div>
      <img src="${i.image}">
      <div class="overlay">
        <div class="tag">${i.category||'Sans cat√©gorie'}</div>
        <h3>${i.name}</h3>
      </div>
    </div>
  `).join('') : '<div class="empty"><h3>Aucun coup de c≈ìur</h3></div>';

  const dailyItems = items.filter(i => daily.includes(i.id));
  document.getElementById('daily').innerHTML = dailyItems.map(i => `
    <div class="card" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite?'‚ù§Ô∏è':'<span style="color:#fff">‚ô°</span>'}</div>
      <img src="${i.image}">
      <div class="overlay">
        <div class="tag">${i.category||'Sans cat√©gorie'}</div>
        <h3>${i.name}</h3>
      </div>
    </div>
  `).join('');

  document.querySelectorAll('.fav-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.stopPropagation();
      toggleFav(btn.dataset.id);
    });
  });

  document.querySelectorAll('.h-card, .card').forEach(card => {
    if (card.dataset.itemId) {
      card.addEventListener('click', e => {
        if (!e.target.classList.contains('fav-btn') && !e.target.closest('.fav-btn')) {
          showDetailModal(card.dataset.itemId);
        }
      });
    }
  });
}

function renderSuppliers() {
  const sups = items.filter(i => i.type==='supplier');
  const cats = ['Tous',...new Set(sups.map(i => i.category).filter(Boolean))];
  
  document.getElementById('cat-suppliers').innerHTML = cats.map(c => 
    `<div class="cat-chip ${c === activeCategorySuppliers ? 'active' : ''}" data-category="${c}">${c}</div>`
  ).join('');

  // Ajouter les √©v√©nements de clic sur les cat√©gories
  document.querySelectorAll('#cat-suppliers .cat-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      activeCategorySuppliers = chip.dataset.category;
      renderSuppliers();
    });
  });

  const rand = [...sups].sort(() => Math.random()-0.5).slice(0,5);
  document.getElementById('disc-suppliers').innerHTML = rand.map(i => `
    <div class="disc-card" data-item-id="${i.id}">
      <img src="${i.image}">
      <div class="name"><h4>${i.name}</h4></div>
    </div>
  `).join('');

  // Filtrer selon la cat√©gorie active
  const filteredSups = activeCategorySuppliers === 'Tous' 
    ? sups 
    : sups.filter(i => i.category === activeCategorySuppliers);

  document.getElementById('pint-suppliers').innerHTML = filteredSups.map((i,idx) => `
    <div class="pint-item ${idx%2===0?'tall':'short'}" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite?'‚ù§Ô∏è':'<span style="color:#fff">‚ô°</span>'}</div>
      <img src="${i.image}">
      <div class="info">
        <h3>${i.name}</h3>
        ${i.category?`<div class="tag">${i.category}</div>`:''}
      </div>
    </div>
  `).join('');

  document.querySelectorAll('#disc-suppliers .disc-card').forEach(card => {
    card.addEventListener('click', () => showDetailModal(card.dataset.itemId));
  });

  document.querySelectorAll('#pint-suppliers .pint-item').forEach(card => {
    card.addEventListener('click', e => {
      if (!e.target.classList.contains('fav-btn') && !e.target.closest('.fav-btn')) {
        showDetailModal(card.dataset.itemId);
      }
    });
  });

  document.querySelectorAll('#pint-suppliers .fav-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.stopPropagation();
      toggleFav(btn.dataset.id);
    });
  });
}

function renderMaterials() {
  const mats = items.filter(i => i.type==='material');
  const cats = ['Tous',...new Set(mats.map(i => i.category).filter(Boolean))];
  
  document.getElementById('cat-materials').innerHTML = cats.map(c => 
    `<div class="cat-chip ${c === activeCategoryMaterials ? 'active' : ''}" data-category="${c}">${c}</div>`
  ).join('');

  // Ajouter les √©v√©nements de clic sur les cat√©gories
  document.querySelectorAll('#cat-materials .cat-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      activeCategoryMaterials = chip.dataset.category;
      renderMaterials();
    });
  });

  const rand = [...mats].sort(() => Math.random()-0.5).slice(0,5);
  document.getElementById('disc-materials').innerHTML = rand.map(i => `
    <div class="disc-card" data-item-id="${i.id}">
      <img src="${i.image}">
      <div class="name"><h4>${i.name}</h4></div>
    </div>
  `).join('');

  // Filtrer selon la cat√©gorie active
  const filteredMats = activeCategoryMaterials === 'Tous' 
    ? mats 
    : mats.filter(i => i.category === activeCategoryMaterials);

  document.getElementById('pint-materials').innerHTML = filteredMats.map((i,idx) => `
    <div class="pint-item ${idx%2===0?'tall':'short'}" data-item-id="${i.id}">
      <div class="fav-btn" data-id="${i.id}">${i.favorite?'‚ù§Ô∏è':'<span style="color:#fff">‚ô°</span>'}</div>
      <img src="${i.image}">
      <div class="info">
        <h3>${i.name}</h3>
        ${i.category?`<div class="tag">${i.category}</div>`:''}
        ${i.price?`<div class="price">${i.price}</div>`:''}
      </div>
    </div>
  `).join('');

  document.querySelectorAll('#disc-materials .disc-card').forEach(card => {
    card.addEventListener('click', () => showDetailModal(card.dataset.itemId));
  });

  document.querySelectorAll('#pint-materials .pint-item').forEach(card => {
    card.addEventListener('click', e => {
      if (!e.target.classList.contains('fav-btn') && !e.target.closest('.fav-btn')) {
        showDetailModal(card.dataset.itemId);
      }
    });
  });

  document.querySelectorAll('#pint-materials .fav-btn').forEach(btn => {
    btn.addEventListener('click', e => {
      e.stopPropagation();
      toggleFav(btn.dataset.id);
    });
  });
}

function toggleMenu() {
  document.getElementById('menu').classList.toggle('active');
}

function toggleFav(id) {
  const item = items.find(i => i.id===id);
  if (item) {
    item.favorite = !item.favorite;
    render();
  }
}

function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
  document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}

function openSearch() {
  document.getElementById('searchModal').classList.add('active');
  document.getElementById('searchInput').focus();
}

function closeSearch() {
  document.getElementById('searchModal').classList.remove('active');
  document.getElementById('searchInput').value = '';
  document.getElementById('searchResults').innerHTML = '';
}

function performSearch() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const results = document.getElementById('searchResults');
  
  if (query.length < 1) {
    results.innerHTML = '';
    return;
  }
  
  const found = items.filter(i => 
    i.name.toLowerCase().includes(query) ||
    (i.category && i.category.toLowerCase().includes(query))
  );
  
  if (found.length === 0) {
    results.innerHTML = '<div class="empty"><h3>Aucun r√©sultat</h3></div>';
  } else {
    results.innerHTML = `<div class="pinterest">${found.map((i,idx) => `
      <div class="pint-item ${idx%2===0?'tall':'short'}">
        <div class="fav-btn" data-id="${i.id}">${i.favorite?'‚ù§Ô∏è':'<span style="color:#fff">‚ô°</span>'}</div>
        <img src="${i.image}">
        <div class="info">
          <h3>${i.name}</h3>
          ${i.category?`<div class="tag">${i.category}</div>`:''}
          ${i.price?`<div class="price">${i.price}</div>`:''}
        </div>
      </div>
    `).join('')}</div>`;
    
    document.querySelectorAll('#searchResults .fav-btn').forEach(btn => {
      btn.addEventListener('click', e => {
        e.stopPropagation();
        toggleFav(btn.dataset.id);
      });
    });
  }
}

function exportData() {
  const blob = new Blob([JSON.stringify(items,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'thecraft-backup.json';
  a.click();
  URL.revokeObjectURL(url);
  toggleMenu();
}

function importData() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.json';
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        items = JSON.parse(ev.target.result);
        render();
        alert('Import√© avec succ√®s!');
      } catch(err) {
        alert('Erreur lors de l\'importation');
      }
    };
    reader.readAsText(file);
  };
  input.click();
  toggleMenu();
}

let selectedType = 'material';

function openFavoritesModal() {
  const favs = items.filter(i => i.favorite);
  const modal = document.getElementById('favoritesModal');
  const list = document.getElementById('favoritesList');
  
  if (favs.length === 0) {
    list.innerHTML = `
      <div class="favorites-empty">
        <h2>Aucun favori</h2>
        <p>Ajoutez vos mat√©riaux et fournisseurs pr√©f√©r√©s en cliquant sur le c≈ìur ‚ô°</p>
      </div>
    `;
  } else {
    list.innerHTML = favs.map(item => `
      <div class="favorite-slide">
        <img src="${item.image}" alt="${item.name}">
        <div class="info-overlay">
          <div class="badge">${item.type === 'material' ? 'MAT√âRIAU' : 'FOURNISSEUR'}</div>
          <h2>${item.name}</h2>
          ${item.contact ? `<p class="supplier">${item.contact}</p>` : ''}
          ${item.description ? `<p class="description">${item.description}</p>` : ''}
          ${item.category || item.price ? `<p class="description">${item.category ? item.category : ''}${item.category && item.price ? ' ‚Ä¢ ' : ''}${item.price ? item.price : ''}</p>` : ''}
        </div>
      </div>
    `).join('');
  }
  
  modal.classList.add('active');
  toggleMenu();
}

function closeFavoritesModal() {
  document.getElementById('favoritesModal').classList.remove('active');
}

function showDetailModal(itemId) {
  const item = items.find(i => i.id === itemId);
  if (!item) return;
  
  const modal = document.getElementById('detailModal');
  const body = document.getElementById('detailBody');
  
  const metaTags = [];
  if (item.category) metaTags.push(`<span class="meta-tag">${item.category}</span>`);
  if (item.price) metaTags.push(`<span class="meta-tag">${item.price}</span>`);
  
  const details = [];
  if (item.contact) details.push(`<p><strong>Contact :</strong> ${item.contact}</p>`);
  if (item.description) details.push(`<p><strong>Description :</strong> ${item.description}</p>`);
  
  body.innerHTML = `
    ${item.image ? `<img src="${item.image}" alt="${item.name}">` : ''}
    <div class="detail-info">
      <h1>${item.name}</h1>
      ${metaTags.length > 0 ? `<div class="detail-meta">${metaTags.join('')}</div>` : ''}
      ${details.join('')}
    </div>
    <div class="detail-actions">
      <button class="close-btn" onclick="closeDetailModal()">Fermer</button>
    </div>
  `;
  
  modal.classList.add('active');
}

function closeDetailModal() {
  document.getElementById('detailModal').classList.remove('active');
}

function openAddForm() {
  document.getElementById('addModal').classList.add('active');
  document.getElementById('itemName').focus();
}

function closeAddForm() {
  document.getElementById('addModal').classList.remove('active');
  document.getElementById('addForm').reset();
  selectedType = 'material';
  document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelector('.type-btn[data-type="material"]').classList.add('active');
}

function selectType(type) {
  selectedType = type;
  document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelector(`.type-btn[data-type="${type}"]`).classList.add('active');
}

function submitForm(e) {
  e.preventDefault();
  
  const newItem = {
    id: Date.now().toString(),
    type: selectedType,
    name: document.getElementById('itemName').value,
    category: document.getElementById('itemCategory').value,
    contact: document.getElementById('itemSupplier').value,
    price: document.getElementById('itemPrice').value,
    description: document.getElementById('itemDescription').value,
    image: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 300"%3E%3Crect fill="%23' + Math.floor(Math.random()*16777215).toString(16) + '" width="400" height="300"/%3E%3C/svg%3E',
    favorite: false,
    createdAt: Date.now(),
    updatedAt: Date.now()
  };
  
  items.push(newItem);
  localStorage.setItem('thecraft-items', JSON.stringify(items));
  render();
  closeAddForm();
  
  alert('‚úÖ ' + newItem.name + ' ajout√© avec succ√®s!');
  
  if (selectedType === 'material') {
    switchTab('materials');
  } else {
    switchTab('suppliers');
  }
}

init();
</script>

</body>
</html>
